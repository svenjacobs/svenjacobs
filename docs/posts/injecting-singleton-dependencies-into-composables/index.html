<!DOCTYPE html>
<html lang="en" dir="auto">

<head><meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="robots" content="index, follow">
<title>Injecting singleton dependencies into composables | Sven Jacobs&#39; Blog</title>
<meta name="keywords" content="android, jetpack, compose, hilt" />
<meta name="description" content="In this short blog post I want to showcase a pattern for &ldquo;injecting&rdquo; global, singleton dependencies into composable functions via Hilt. You should be familiar with Compose and Hilt. An understanding of ViewModel and Coil is helpful, but not required.
In Compose, a composable function should only receive the data via function arguments that is required for rendering the UI. This design pattern decouples composables and improves reusability. It is true for plain data, but it might not be that helpful for dependencies.">
<meta name="author" content="">
<link rel="canonical" href="https://blog.svenjacobs.com/posts/injecting-singleton-dependencies-into-composables/" />
<link crossorigin="anonymous" href="/assets/css/stylesheet.min.83c4eb6d61e6a4176992e4a4ce8786fc30bd40032ba8663ec5d11e285a965766.css" integrity="sha256-g8TrbWHmpBdpkuSkzoeG/DC9QAMrqGY&#43;xdEeKFqWV2Y=" rel="preload stylesheet" as="style">
<link rel="icon" href="https://blog.svenjacobs.com/favicon.ico">
<link rel="icon" type="image/png" sizes="16x16" href="https://blog.svenjacobs.com/favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="https://blog.svenjacobs.com/favicon-32x32.png">
<link rel="apple-touch-icon" href="https://blog.svenjacobs.com/apple-touch-icon.png">
<link rel="mask-icon" href="https://blog.svenjacobs.com/safari-pinned-tab.svg">
<meta name="theme-color" content="#2e2e33">
<meta name="msapplication-TileColor" content="#2e2e33">
<meta name="generator" content="Hugo 0.88.1" />
<noscript>
    <style>
        #theme-toggle,
        .top-link {
            display: none;
        }

    </style>
    <style>
        @media (prefers-color-scheme: dark) {
            :root {
                --theme: rgb(29, 30, 32);
                --entry: rgb(46, 46, 51);
                --primary: rgb(218, 218, 219);
                --secondary: rgb(155, 156, 157);
                --tertiary: rgb(65, 66, 68);
                --content: rgb(196, 196, 197);
                --hljs-bg: rgb(46, 46, 51);
                --code-bg: rgb(55, 56, 62);
                --border: rgb(51, 51, 51);
            }

            .list {
                background: var(--theme);
            }

            .list:not(.dark)::-webkit-scrollbar-track {
                background: 0 0;
            }

            .list:not(.dark)::-webkit-scrollbar-thumb {
                border-color: var(--theme);
            }
        }

    </style>
</noscript><meta property="og:title" content="Injecting singleton dependencies into composables" />
<meta property="og:description" content="In this short blog post I want to showcase a pattern for &ldquo;injecting&rdquo; global, singleton dependencies into composable functions via Hilt. You should be familiar with Compose and Hilt. An understanding of ViewModel and Coil is helpful, but not required.
In Compose, a composable function should only receive the data via function arguments that is required for rendering the UI. This design pattern decouples composables and improves reusability. It is true for plain data, but it might not be that helpful for dependencies." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://blog.svenjacobs.com/posts/injecting-singleton-dependencies-into-composables/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2021-10-05T21:50:00&#43;02:00" />
<meta property="article:modified_time" content="2021-10-05T21:50:00&#43;02:00" />

<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Injecting singleton dependencies into composables"/>
<meta name="twitter:description" content="In this short blog post I want to showcase a pattern for &ldquo;injecting&rdquo; global, singleton dependencies into composable functions via Hilt. You should be familiar with Compose and Hilt. An understanding of ViewModel and Coil is helpful, but not required.
In Compose, a composable function should only receive the data via function arguments that is required for rendering the UI. This design pattern decouples composables and improves reusability. It is true for plain data, but it might not be that helpful for dependencies."/>


<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BreadcrumbList",
  "itemListElement": [
    {
      "@type": "ListItem",
      "position":  1 ,
      "name": "Posts",
      "item": "https://blog.svenjacobs.com/posts/"
    }, 
    {
      "@type": "ListItem",
      "position":  2 ,
      "name": "Injecting singleton dependencies into composables",
      "item": "https://blog.svenjacobs.com/posts/injecting-singleton-dependencies-into-composables/"
    }
  ]
}
</script>
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "Injecting singleton dependencies into composables",
  "name": "Injecting singleton dependencies into composables",
  "description": "In this short blog post I want to showcase a pattern for \u0026ldquo;injecting\u0026rdquo; global, singleton dependencies into composable functions via Hilt. You should be familiar with Compose and Hilt. An understanding of ViewModel and Coil is helpful, but not required.\nIn Compose, a composable function should only receive the data via function arguments that is required for rendering the UI. This design pattern decouples composables and improves reusability. It is true for plain data, but it might not be that helpful for dependencies.",
  "keywords": [
    "android", "jetpack", "compose", "hilt"
  ],
  "articleBody": "In this short blog post I want to showcase a pattern for “injecting” global, singleton dependencies into composable functions via Hilt. You should be familiar with Compose and Hilt. An understanding of ViewModel and Coil is helpful, but not required.\nIn Compose, a composable function should only receive the data via function arguments that is required for rendering the UI. This design pattern decouples composables and improves reusability. It is true for plain data, but it might not be that helpful for dependencies. Imagine for instance setting up a Coil ImageLoader instance via Hilt, adding a few custom interceptors, a logger, etc. Because of this configuration, you want to use the same singleton instance throughout your app. Therefore you install the module which configures ImageLoader into Hilt’s Singleton component.\nMost times you should not have to pass dependencies to composables other than required data, as mentioned above. If you find yourself doing this a lot, there might be a problem with the design of your composables. However in case of Coil’s Compose support, you do need an instance of ImageLoader if you want to benefit from its special configuration.\nAt one of your top-level composables which represents a screen, you might access dependencies via a ViewModel. That is fine so far. Now a child composable two layers down also needs that instance of ImageLoader. You might pass down the ViewModel as a function argument, which is not cool. You might just pass down the ImageLoader instance, which is better but still not cool. It’s cumbersome and does not help in improving readability, reusability and testability of composables.\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25  @Composable fun MainScreen(viewModel: MainViewModel = viewModel()) { Child1(viewModel.imageLoader) } @Composable fun Child1(imageLoader: ImageLoader) { Child2( imageUrl = \"www.someurl.com\", imageLoader = imageLoader ) } @Composable fun Child2( imageUrl: String, imageLoader: ImageLoader ) { Image( painter = rememberImagePainter( data = imageUrl, imageLoader = imageLoader ) ) }   Do you see how ImageLoader pollutes Child1? It gets worse if ImageLoader is required by more child composables deeper down.\nThe solution Before I go into the details I want to emphasize that this solution only works with dependencies that are declared as singletons in Hilt. It does not work for dependencies that should be tied to a lifecycle which is smaller, for instance the lifecycle of a composable.\nThat being said, let’s improve the code sample above.\nFirst of all we need to know that we cannot use the @Inject annotation on parameters of composable functions. Maybe this will be possible in the future – who knows – but it’s not possible at the time of writing this article. So this complicates things a bit. But how do we obtain our Hilt dependencies then? Luckily, Hilt provides a solution for accessing dependencies in code which is not one of Hilt’s supported classes (Activity, Fragment, Service, …). It is called EntryPoint. If you’re not familiar with EntryPoint, please read the linked documentation first.\nLet’s write an EntryPoint which provides our ImageLoader dependency:\n1 2 3 4 5  @EntryPoint @InstallIn(SingletonComponent::class) interface ComposeEntryPoint { val imageLoader: ImageLoader }   Now we need to initialize ComposeEntryPoint from a Compose context. We utilize the CompositionLocal LocalContext for accessing the current Android Context inside a composable. Let’s create a file Providers.kt (or name it anything you want):\n1 2 3 4 5 6 7 8 9 10 11 12 13  private lateinit var entryPoint: ComposeEntryPoint @Composable fun requireEntryPoint(): ComposeEntryPoint { if (!::entryPoint.isInitialized) { entryPoint = EntryPoints.get( LocalContext.current.applicationContext,  ComposeEntryPoint::class.java, ) } return entryPoint }   As you can see we use a lateinit property. We ensure that only one instance of ComposeEntryPoint is created and that further calls to requireEntryPoint will return the same instance. It is a minor optimization. Why not use by lazy { … } you ask? That is a good question! Unfortunately, the lambda which is passed to lazy is not a composable function. Hence we cannot access LocalContext there.\nLast but not least, in the same file as above, we create the actual function that returns our dependency in question:\n1 2  @Composable fun imageLoader() = requireEntryPoint().imageLoader   Now we can improve the code sample:\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22  @Composable fun MainScreen() { Child1() } @Composable fun Child1() { Child2(imageUrl = \"www.someurl.com\") } @Composable fun Child2( imageUrl: String, imageLoader: ImageLoader = imageLoader() ) { Image( painter = rememberImagePainter( data = imageUrl, imageLoader = imageLoader ) ) }   I hope you find this simple pattern useful 🙂\n",
  "wordCount" : "777",
  "inLanguage": "en",
  "datePublished": "2021-10-05T21:50:00+02:00",
  "dateModified": "2021-10-05T21:50:00+02:00",
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": "https://blog.svenjacobs.com/posts/injecting-singleton-dependencies-into-composables/"
  },
  "publisher": {
    "@type": "Organization",
    "name": "Sven Jacobs' Blog",
    "logo": {
      "@type": "ImageObject",
      "url": "https://blog.svenjacobs.com/favicon.ico"
    }
  }
}
</script>
</head>

<body class="" id="top">
<script>
    if (localStorage.getItem("pref-theme") === "dark") {
        document.body.classList.add('dark');
    } else if (localStorage.getItem("pref-theme") === "light") {
        document.body.classList.remove('dark')
    } else if (window.matchMedia('(prefers-color-scheme: dark)').matches) {
        document.body.classList.add('dark');
    }

</script>

<header class="header">
    <nav class="nav">
        <div class="logo">
            <a href="https://blog.svenjacobs.com/" accesskey="h" title="Sven Jacobs&#39; Blog (Alt + H)">Sven Jacobs&#39; Blog</a>
            <span class="logo-switches">
                <button id="theme-toggle" accesskey="t" title="(Alt + T)">
                    <svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
                    </svg>
                    <svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <circle cx="12" cy="12" r="5"></circle>
                        <line x1="12" y1="1" x2="12" y2="3"></line>
                        <line x1="12" y1="21" x2="12" y2="23"></line>
                        <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
                        <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
                        <line x1="1" y1="12" x2="3" y2="12"></line>
                        <line x1="21" y1="12" x2="23" y2="12"></line>
                        <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
                        <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
                    </svg>
                </button>
            </span>
        </div>
        <ul id="menu">
        </ul>
    </nav>
</header>
<main class="main">

<article class="post-single">
  <header class="post-header">
    
    <h1 class="post-title">
      Injecting singleton dependencies into composables
    </h1>
    <div class="post-meta">October 5, 2021
</div>
  </header> 
  <div class="post-content"><p>In this short blog post I want to showcase a pattern for &ldquo;injecting&rdquo; global, singleton dependencies into composable functions via <a href="https://developer.android.com/training/dependency-injection/hilt-android">Hilt</a>. You should be familiar with <a href="https://developer.android.com/jetpack/compose">Compose</a> and Hilt. An understanding of <a href="https://developer.android.com/topic/libraries/architecture/viewmodel">ViewModel</a> and <a href="https://github.com/coil-kt/coil">Coil</a> is helpful, but not required.</p>
<p>In Compose, a composable function should only receive the data via function arguments that is required for rendering the UI. This design pattern decouples composables and improves reusability. It is true for plain data, but it might not be that helpful for dependencies. Imagine for instance setting up a Coil <code>ImageLoader</code> instance via Hilt, adding a few custom interceptors, a logger, etc. Because of this configuration, you want to use the same singleton instance throughout your app. Therefore you install the module which configures <code>ImageLoader</code> into Hilt&rsquo;s <code>Singleton</code> component.</p>
<p>Most times you should not have to pass dependencies to composables other than required data, as mentioned above. If you find yourself doing this a lot, there might be a problem with the design of your composables. However in case of Coil&rsquo;s <a href="https://coil-kt.github.io/coil/compose/">Compose support</a>, you do need an instance of <code>ImageLoader</code> if you want to benefit from its special configuration.</p>
<p>At one of your top-level composables which represents a screen, you might access dependencies via a <code>ViewModel</code>. That is fine so far. Now a child composable two layers down also needs that instance of <code>ImageLoader</code>. You might pass down the <code>ViewModel</code> as a function argument, which is not cool. You might just pass down the <code>ImageLoader</code> instance, which is better but still not cool. It&rsquo;s cumbersome and does not help in improving readability, reusability and testability of composables.</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">23
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">24
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">25
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-kotlin" data-lang="kotlin"><span style="color:#a6e22e">@Composable</span>
<span style="color:#66d9ef">fun</span> <span style="color:#a6e22e">MainScreen</span>(viewModel: MainViewModel = viewModel()) {
  Child1(viewModel.imageLoader)
}

<span style="color:#a6e22e">@Composable</span>
<span style="color:#66d9ef">fun</span> <span style="color:#a6e22e">Child1</span>(imageLoader: ImageLoader) {
  Child2(
    imageUrl = <span style="color:#e6db74">&#34;www.someurl.com&#34;</span>,
    imageLoader = imageLoader
  )
}

<span style="color:#a6e22e">@Composable</span>
<span style="color:#66d9ef">fun</span> <span style="color:#a6e22e">Child2</span>(
  imageUrl: String,
  imageLoader: ImageLoader
) {
  Image(
    painter = rememberImagePainter(
      <span style="color:#66d9ef">data</span> = imageUrl,
      imageLoader = imageLoader
    )
  )
}
</code></pre></td></tr></table>
</div>
</div><p>Do you see how <code>ImageLoader</code> pollutes <code>Child1</code>? It gets worse if <code>ImageLoader</code> is required by more child composables deeper down.</p>
<h2 id="the-solution">The solution<a hidden class="anchor" aria-hidden="true" href="#the-solution">#</a></h2>
<p>Before I go into the details I want to emphasize that this solution only works with dependencies that are declared as singletons in Hilt. It does not work for dependencies that should be tied to a lifecycle which is smaller, for instance the lifecycle of a composable.</p>
<p>That being said, let&rsquo;s improve the code sample above.</p>
<p>First of all we need to know that we cannot use the <code>@Inject</code> annotation on parameters of composable functions. Maybe this will be possible in the future – who knows – but it&rsquo;s not possible at the time of writing this article. So this complicates things a bit. But how do we obtain our Hilt dependencies then? Luckily, Hilt provides a solution for accessing dependencies in code which is not one of Hilt&rsquo;s supported classes (<code>Activity</code>, <code>Fragment</code>, <code>Service</code>, …). It is called <a href="https://dagger.dev/hilt/entry-points.html">EntryPoint</a>. If you&rsquo;re not familiar with <code>EntryPoint</code>, please read the linked documentation first.</p>
<p>Let&rsquo;s write an <code>EntryPoint</code> which provides our <code>ImageLoader</code> dependency:</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-kotlin" data-lang="kotlin"><span style="color:#a6e22e">@EntryPoint</span>
<span style="color:#a6e22e">@InstallIn</span>(SingletonComponent<span style="color:#f92672">::</span><span style="color:#66d9ef">class</span>)
<span style="color:#66d9ef">interface</span> <span style="color:#a6e22e">ComposeEntryPoint</span> {
    <span style="color:#66d9ef">val</span> imageLoader: ImageLoader
}
</code></pre></td></tr></table>
</div>
</div><p>Now we need to initialize <code>ComposeEntryPoint</code> from a Compose context. We utilize the <a href="https://developer.android.com/jetpack/compose/compositionlocal">CompositionLocal</a> <code>LocalContext</code> for accessing the current Android <code>Context</code> inside a composable. Let&rsquo;s create a file <code>Providers.kt</code> (or name it anything you want):</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="display:block;width:100%;background-color:#3c3d38"><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span></span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-kotlin" data-lang="kotlin"><span style="color:#66d9ef">private</span> <span style="color:#66d9ef">lateinit</span> <span style="color:#66d9ef">var</span> entryPoint: ComposeEntryPoint

<span style="color:#a6e22e">@Composable</span>
<span style="color:#66d9ef">fun</span> <span style="color:#a6e22e">requireEntryPoint</span>(): ComposeEntryPoint {
    <span style="color:#66d9ef">if</span> (!<span style="color:#f92672">::</span>entryPoint.isInitialized) {
        entryPoint =
            EntryPoints.<span style="color:#66d9ef">get</span>(
<span style="display:block;width:100%;background-color:#3c3d38">                LocalContext.current.applicationContext,
</span>                ComposeEntryPoint<span style="color:#f92672">::</span><span style="color:#66d9ef">class</span>.java,
            )
    }
    <span style="color:#66d9ef">return</span> entryPoint
}
</code></pre></td></tr></table>
</div>
</div><p>As you can see we use a <code>lateinit</code> property. We ensure that only one instance of <code>ComposeEntryPoint</code> is created and that further calls to <code>requireEntryPoint</code> will return the same instance. It is a minor optimization. Why not use <code>by lazy { … }</code> you ask? That is a good question! Unfortunately, the lambda which is passed to <code>lazy</code> is not a composable function. Hence we cannot access <code>LocalContext</code> there.</p>
<p>Last but not least, in the same file as above, we create the actual function that returns our dependency in question:</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-kotlin" data-lang="kotlin"><span style="color:#a6e22e">@Composable</span>
<span style="color:#66d9ef">fun</span> <span style="color:#a6e22e">imageLoader</span>() = requireEntryPoint().imageLoader
</code></pre></td></tr></table>
</div>
</div><p>Now we can improve the code sample:</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="display:block;width:100%;background-color:#3c3d38"><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span></span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-kotlin" data-lang="kotlin"><span style="color:#a6e22e">@Composable</span>
<span style="color:#66d9ef">fun</span> <span style="color:#a6e22e">MainScreen</span>() {
  Child1()
}

<span style="color:#a6e22e">@Composable</span>
<span style="color:#66d9ef">fun</span> <span style="color:#a6e22e">Child1</span>() {
  Child2(imageUrl = <span style="color:#e6db74">&#34;www.someurl.com&#34;</span>)
}

<span style="color:#a6e22e">@Composable</span>
<span style="color:#66d9ef">fun</span> <span style="color:#a6e22e">Child2</span>(
  imageUrl: String,
<span style="display:block;width:100%;background-color:#3c3d38">  imageLoader: ImageLoader = imageLoader()
</span>) {
  Image(
    painter = rememberImagePainter(
      <span style="color:#66d9ef">data</span> = imageUrl,
      imageLoader = imageLoader
    )
  )
}
</code></pre></td></tr></table>
</div>
</div><p>I hope you find this simple pattern useful 🙂</p>


  </div>

  <footer class="post-footer">
    <ul class="post-tags">
      <li><a href="https://blog.svenjacobs.com/tags/android/">android</a></li>
      <li><a href="https://blog.svenjacobs.com/tags/jetpack/">jetpack</a></li>
      <li><a href="https://blog.svenjacobs.com/tags/compose/">compose</a></li>
      <li><a href="https://blog.svenjacobs.com/tags/hilt/">hilt</a></li>
    </ul>
  </footer>
</article>
    </main>
    
<footer class="footer">
    <span>&copy; 2021 <a href="https://blog.svenjacobs.com/">Sven Jacobs&#39; Blog</a></span>
    <span>
        Powered by
        <a href="https://gohugo.io/" rel="noopener noreferrer" target="_blank">Hugo</a> &
        <a href="https://git.io/hugopapermod" rel="noopener" target="_blank">PaperMod</a>
    </span>
</footer>
<a href="#top" aria-label="go to top" title="Go to Top (Alt + G)" class="top-link" id="top-link" accesskey="g">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentColor">
        <path d="M12 6H0l6-6z" />
    </svg>
</a>

<script>
    let menu = document.getElementById('menu')
    menu.scrollLeft = localStorage.getItem("menu-scroll-position");
    menu.onscroll = function () {
        localStorage.setItem("menu-scroll-position", menu.scrollLeft);
    }

    document.querySelectorAll('a[href^="#"]').forEach(anchor => {
        anchor.addEventListener("click", function (e) {
            e.preventDefault();
            var id = this.getAttribute("href").substr(1);
            if (!window.matchMedia('(prefers-reduced-motion: reduce)').matches) {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView({
                    behavior: "smooth"
                });
            } else {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView();
            }
            if (id === "top") {
                history.replaceState(null, null, " ");
            } else {
                history.pushState(null, null, `#${id}`);
            }
        });
    });

</script>
<script>
    var mybutton = document.getElementById("top-link");
    window.onscroll = function () {
        if (document.body.scrollTop > 800 || document.documentElement.scrollTop > 800) {
            mybutton.style.visibility = "visible";
            mybutton.style.opacity = "1";
        } else {
            mybutton.style.visibility = "hidden";
            mybutton.style.opacity = "0";
        }
    };

</script>
<script>
    document.getElementById("theme-toggle").addEventListener("click", () => {
        if (document.body.className.includes("dark")) {
            document.body.classList.remove('dark');
            localStorage.setItem("pref-theme", 'light');
        } else {
            document.body.classList.add('dark');
            localStorage.setItem("pref-theme", 'dark');
        }
    })

</script>
</body>

</html>
